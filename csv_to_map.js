"use strict";function loadGoogleMaps(){var e=document.createElement("script");e.type="text/javascript",e.src="http://maps.googleapis.com/maps/api/js?key=AIzaSyBssEZ7lXU4R9Do3zYoG_kroKpxxRHCssI&sensor=true&callback=onLoadGoogleMaps",document.body.appendChild(e)}function onLoadGoogleMaps(){setupGoogleMaps(),load5374Datas()}function setupGoogleMaps(){var e={zoom:8,center:new google.maps.LatLng(36.561325,136.656205),mapTypeId:google.maps.MapTypeId.ROADMAP};googleMap=new google.maps.Map(document.getElementById("map_canvas"),e)}function load5374Datas(){$.ajax({url:"5374.json",method:"GET",dataType:"json",success:function(e){areas=e.areas,onLoad5374Data()},error:function(e,a,t){alert("\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002cfk-office@codeforkanazawa.org\u307e\u3067\u3054\u9023\u7d61\u304f\u3060\u3055\u3044\u3002")}})}function onLoad5374Data(){putMarkers(),createPrefectureSelect(),showLatestData(),$("#prefecture_area").on("change",function(){var e=parseInt($(this).val());createCitySelect(e)}),$("#city_area").on("change",function(){var e=$(this).val(),a=getCity(e);return a?(googleMap.panTo(new google.maps.LatLng(a.latitude,a.longitude)),void googleMap.setZoom(15)):void alert(sprintf("\u4e0d\u6b63\u306a\u5e02\u533a\u753a\u6751(%(code)s)\u304c\u9078\u629e\u3055\u308c\u307e\u3057\u305f\u3002cfk-office@codeforkanazawa.org\u307e\u3067\u3054\u9023\u7d61\u304f\u3060\u3055\u3044\u3002",{code:e}))}),$("#go_page").on("click",function(){var e=$("#city_area").val(),a=getCity(e);return a?void(location.href=a.url):void alert("\u30a8\u30ea\u30a2\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002")}),$("#prefecture_area").change()}function putMarkers(){for(var e=0;e<areas.length;++e)for(var a=areas[e],t=a.prefectures,r=0;r<t.length;++r)for(var o=t[r],n=o.cities,c=0;c<n.length;++c){var s=n[c];putMarker(o,s)}}function putMarker(e,a){var t=new google.maps.LatLng(a.latitude,a.longitude),r=new google.maps.Marker({position:t,map:googleMap,title:a.name}),o=a.url,n=e.name+a.name,c=new google.maps.InfoWindow({content:n+"<br><a href='"+o+"'>"+o+"</a><br>\u66f4\u65b0\u65e5"+a.date});google.maps.event.addListener(r,"click",function(){currentInfoWindow&&currentInfoWindow.close(),currentInfoWindow=c,c.open(googleMap,r)})}function createPrefectureSelect(){for(var e=[],a=0;a<areas.length;++a){for(var t=areas[a],r=t.prefectures,o=$("<optgroup>").attr("label",t.name),n=0;n<r.length;++n){var c=r[n],s=$("<option>").text(c.name).val(c.code);o.append(s)}e.push(o)}$("#prefecture_area").empty().append(e)}function createCitySelect(e){var a=getPrefecture(e),t=[];t.push($("<option>").text("\u30a8\u30ea\u30a2\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002"));for(var r=a.cities,o=0;o<r.length;++o){var n=r[o];t.push($("<option>").text(n.name).val(n.code))}$("#city_area").empty().append(t)}function showLatestData(){for(var e=getAllSortedCities(),a="",t=0;t<e.length&&LATEST_ELEMENTS>t;++t){var r=e[t];a+=sprintf("<p>%(date)s\u306b<a href='%(url)s'>%(name)s\u72485374</a>\u304c\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002</p>",r)}$("#latest_list").html(a)}function getArea(e){for(var a=0;a<areas.length;++a){var t=areas[a];if(t.code===e)return t}return null}function getPrefecture(e){var a=getAreaCodeFromPrefectureCode(e),t=getArea(a);if(!t)return null;for(var r=t.prefectures,o=0;o<r.length;++o){var n=r[o];if(n.code===e)return n}return null}function getCity(e){var a=parseInt((""+e).substr(0,2)),t=getPrefecture(a);if(!t)return null;for(var r=t.cities,o=0;o<r.length;++o){var n=r[o];if(n.code===e)return n}return null}function getAllSortedCities(){for(var e=[],a=0;a<areas.length;++a)for(var t=areas[a],r=t.prefectures,o=0;o<r.length;++o)for(var n=r[o],c=n.cities,s=0;s<c.length;++s){var l=c[s];e.push(l)}return e.sort(compareDate),e}function compareDate(e,a){function t(e){return e-0}for(var r=e.date.split(".").map(t),o=a.date.split(".").map(t),n=0;n<r.length;n++){if(r[n]>o[n])return-1;if(r[n]<o[n])return 1}return 0}function getAreaCodeFromPrefectureCode(e){switch(e){case 1:return 1;case 2:case 3:case 4:case 5:case 6:case 7:return 2;case 8:case 9:case 10:case 11:case 12:case 13:case 14:return 3;case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:return 4;case 24:case 25:case 26:case 27:case 28:case 29:case 30:return 5;case 31:case 32:case 33:case 34:case 35:return 6;case 36:case 37:case 38:case 39:return 7;case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:return 8}return 0}var LATEST_ELEMENTS=5,areas=[],googleMap,currentInfoWindow=null;$(function(){$(".collapse").on("shown.bs.collapse",function(){$("html,body").animate({scrollTop:$(this).parent().offset().top},0)}),loadGoogleMaps()});